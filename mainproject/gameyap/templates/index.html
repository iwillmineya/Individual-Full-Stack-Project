{% extends "base.html" %}
{% block content %}

  <!-- Search and Filter Form -->
  <form method="get" action="" class="mb-4">
  <div class="row">
    <div class="col-md-4 mb-2">
      <input type="text" name="search" class="form-control" placeholder="Search games..." value="{{ search_query }}">
    </div>
    <div class="col-md-3 mb-2">
      <select name="genre" class="form-control">
        <option value="">All Genres</option>
        {% for genre in genres %}
          <option value="{{ genre }}" {% if genre == genre_query %}selected{% endif %}>{{ genre }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3 mb-2">
      <input type="date" name="release_date" class="form-control" value="{{ release_query }}">
    </div>
    <div class="col-md-2 mb-2">
      <button type="submit" class="btn btn-primary w-100">Search</button>
    </div>
  </div>
  </form>

<div class="container-fluid gamer-bg">
  <!-- Featured Game Carousel -->
  <div id="featuredGameCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-inner">
      {% for game in featured_games %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        <div class="d-flex justify-content-center align-items-center" style="min-height: 250px;">
          <div class="card shadow-lg text-center" style="width: 22rem; background: linear-gradient(120deg, #23243a 0%, #181824 100%); color: #e0e3f3; border-radius: 1rem;">
            <div class="card-body">
              <h3 class="card-title text-primary fw-bold">{{ game.title }}</h3>
              <span class="badge bg-info text-dark mb-2"><strong>Genre:</strong> {{ game.genre }}</span><br>
              <span class="badge bg-secondary mb-2"><strong>Release Date:</strong> {{ game.release_date }}</span><br>
              <p class="card-text mt-2">{{ game.description|truncatewords:20 }}</p>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#featuredGameCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#featuredGameCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
  <div class="row">
    <!-- Left Leaderboard -->
    <aside class="col-lg-2 d-none d-lg-block">
      <div class="leaderboard p-3 mb-4 bg-white shadow rounded" style="min-height: 80vh;">
        <h4 class="text-center text-primary mb-3">Top 10 Overwatch</h4>
        <ol class="leaderboard-list" style="height: 60vh; overflow-y: auto; font-size: 0.95rem;">
          {% for player in leaderboard_ow %}
            <li class="mb-1">{{ forloop.counter }}. {{ player }}</li>
          {% endfor %}
        </ol>
        <div class="mt-2">
          <h5 class="text-center text-secondary">Honourable Mention</h5>
          <ul class="list-unstyled text-center">
            <li id="ow-honourable-1">appiekitty</li>
            <li id="ow-honourable-2">Crestedgecko</li>
            <li id="ow-honourable-3">Fequi</li>
          </ul>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="col-lg-8">
      <section class="hero-section text-center py-5" style="background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%); color: #fff; border-radius: 1rem; margin-bottom: 2rem;">
          <h1 class="display-4 fw-bold mb-3">Welcome to GameYap!</h1>
          <p class="lead mb-4">Discover, track, and share your favorite games. Add new games, edit details, and manage your collection with ease.</p>
          {% if user.is_authenticated %}
              <a href="{% url 'game_create' %}" class="btn btn-light btn-lg shadow">Add New Game</a>
          {% else %}
              <a href="{% url 'login' %}" class="btn btn-outline-light btn-lg shadow">Login to Add Games</a>
          {% endif %}
      </section>

      <section aria-labelledby="game-list-heading">
          <h2 id="game-list-heading" class="mb-4 text-center fw-bold">Game Library</h2>
          <div class="row g-4 justify-content-center" role="list">
              {% for game in games %}
                  <article class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex" role="listitem">
                      <div class="card mb-4 h-100 shadow-lg game-card" tabindex="0" aria-label="{{ game.title }} game card" style="transition: transform 0.2s, box-shadow 0.2s; border-radius: 1rem;">
                          <div class="card-body d-flex flex-column justify-content-between">
                              <h3 class="card-title text-primary fw-bold">{{ game.title }}</h3>
                              <p class="card-text mb-3">
                                  <span class="badge bg-info text-dark mb-2"><strong>Genre:</strong> {{ game.genre }}</span><br>
                                  <span class="badge bg-secondary mb-2"><strong>Release Date:</strong> {{ game.release_date }}</span><br>
                                  <span>{{ game.description }}</span>
                              </p>
                              <div class="mt-auto">
                                {% if user.is_authenticated and user == game.user %}
                                  <a href="{% url 'game_update' game.pk %}" class="btn btn-outline-warning me-2 mb-2" aria-label="Edit {{ game.title }}">Edit</a>
                                  <a href="{% url 'game_delete' game.pk %}" class="btn btn-outline-danger mb-2" aria-label="Delete {{ game.title }}">Delete</a>
                                {% endif %}
                              </div>
                          </div>
                      </div>
                  </article>
              {% empty %}
                  <div class="col-12 text-center">
                      <p class="fs-4 text-muted">No games found. Start by adding your first game!</p>
                  </div>
              {% endfor %}
          </div>
      </section>
    </main>

    <!-- Right Leaderboard -->
    <aside class="col-lg-2 d-none d-lg-block">
      <div class="leaderboard p-3 mb-4 bg-white shadow rounded" style="min-height: 80vh;">
        <h4 class="text-center text-danger mb-3">Top 10 Valorant</h4>
        <ol class="leaderboard-list" style="height: 60vh; overflow-y: auto; font-size: 0.95rem;">
          {% for player in leaderboard_val %}
            <li class="mb-1">{{ forloop.counter }}. {{ player }}</li>
          {% endfor %}
        </ol>
        <div class="mt-2">
          <h5 class="text-center text-secondary">Honourable Mention</h5>
          <ul class="list-unstyled text-center">
            <li id="val-honourable-1">sirraHT#9281</li>
            <li id="val-honourable-2">REV</li>
            <li id="val-honourable-3">iwillmineyou#dog</li>
            <li id="val-honourable-4">Bean#3344</li>
          </ul>
        </div>
      </div>
    </aside>
  </div>
</div>

<style>
  body, .gamer-bg {
    background: linear-gradient(135deg, #181824 0%, #23243a 100%);
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }
  .gamer-bg::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 0;
    background: url('https://www.transparenttextures.com/patterns/cubes.png'), linear-gradient(120deg, rgba(106,17,203,0.12) 0%, rgba(37,117,252,0.12) 100%);
    opacity: 0.25;
    pointer-events: none;
  }
  .container-fluid, .row, .leaderboard, .hero-section, main {
    position: relative;
    z-index: 1;
  }
  .game-card:hover, .game-card:focus {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 8px 32px rgba(106,17,203,0.15), 0 1.5px 6px rgba(37,117,252,0.12);
    outline: none;
  }
  .hero-section {
    box-shadow: 0 4px 24px rgba(37,117,252,0.12);
  }
  .leaderboard {
    background: linear-gradient(135deg, #23243a 0%, #181824 100%);
    border-left: 6px solid #6a11cb;
    border-right: 6px solid #2575fc;
    max-height: 90vh;
    color: #e0e3f3;
  }
  .leaderboard-list {
    list-style: decimal inside;
    padding-left: 0;
    margin-bottom: 0;
  }
  .text-primary, .text-danger, .text-secondary {
    text-shadow: 0 2px 8px rgba(37,117,252,0.15);
  }
  .card {
    background: linear-gradient(120deg, #23243a 0%, #181824 100%);
    color: #e0e3f3;
    border: none;
  }
  .card-title {
    color: #6a11cb;
  }
  .badge.bg-info {
    background: #2575fc;
    color: #fff;
  }
  .badge.bg-secondary {
    background: #181824;
    color: #fff;
  }
  </style>
</style>

{% endblock %}